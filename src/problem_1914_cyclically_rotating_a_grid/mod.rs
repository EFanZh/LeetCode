pub mod iterative;

pub trait Solution {
    fn rotate_grid(grid: Vec<Vec<i32>>, k: i32) -> Vec<Vec<i32>>;
}

#[cfg(test)]
mod tests {
    use super::Solution;
    use crate::test_utilities::Matrix;

    type TestCase<'a> = ((&'a dyn Matrix<i32>, i32), &'a dyn Matrix<i32>);

    const EXTRA_TEST_CASE: TestCase = (
        (
            &[
                [
                    386, 2615, 3563, 3035, 475, 3444, 729, 1583, 2866, 1550, 1186, 704, 1729, 2864, 2614, 4837, 4373,
                    4225, 4352, 3820, 358, 4104, 1016, 1441, 1907, 674, 2256, 2441,
                ],
                [
                    4736, 1231, 2739, 3967, 653, 57, 270, 814, 2173, 2363, 616, 1619, 4910, 4770, 2530, 2741, 2365,
                    4659, 4395, 3047, 127, 4963, 3414, 4928, 3373, 339, 4367, 2925,
                ],
                [
                    81, 2738, 304, 4520, 2061, 172, 3348, 4773, 503, 1583, 1285, 3832, 103, 2693, 1174, 741, 2459,
                    1007, 28, 3718, 3414, 2036, 1965, 778, 2183, 1761, 4830, 1329,
                ],
                [
                    3622, 3304, 1915, 50, 610, 2357, 1646, 3948, 3466, 3408, 4083, 3824, 2545, 4915, 2632, 1240, 2417,
                    4208, 2247, 2846, 1443, 2567, 1479, 4901, 3249, 619, 1447, 3335,
                ],
                [
                    2331, 81, 4906, 50, 1802, 4856, 2284, 4087, 355, 4972, 271, 2178, 3028, 4392, 1499, 3564, 1848,
                    909, 1572, 129, 1950, 1546, 300, 3769, 3789, 4548, 882, 1193,
                ],
                [
                    2122, 4654, 218, 4630, 741, 1972, 820, 3477, 4823, 1547, 1764, 2448, 4099, 2217, 3914, 434, 3922,
                    3619, 4132, 4731, 373, 3197, 1997, 2317, 2270, 482, 4922, 928,
                ],
                [
                    895, 94, 3365, 1878, 3168, 149, 180, 1789, 1779, 4570, 1643, 2472, 3202, 455, 2411, 2461, 584,
                    2229, 2030, 3902, 4938, 3859, 2196, 1123, 4843, 4368, 4657, 873,
                ],
                [
                    2383, 3483, 236, 4925, 4605, 2869, 1707, 232, 2174, 3762, 621, 1791, 2726, 673, 4721, 905, 208,
                    3535, 1146, 726, 3811, 4680, 157, 2565, 823, 4707, 3425, 4534,
                ],
                [
                    3097, 196, 3162, 262, 4863, 4110, 2601, 2642, 1693, 403, 3875, 3983, 1791, 3608, 4092, 894, 4808,
                    26, 610, 2019, 3321, 3596, 3189, 1685, 4755, 3273, 4286, 3679,
                ],
                [
                    1721, 3223, 585, 715, 124, 3337, 2000, 2216, 2551, 3415, 1489, 2616, 1673, 2115, 2413, 2995, 3866,
                    932, 3444, 1942, 2223, 1146, 4428, 216, 2106, 4311, 3472, 721,
                ],
                [
                    4061, 2672, 707, 4023, 1242, 1430, 2396, 4515, 214, 1061, 4998, 4264, 2589, 704, 2671, 3783, 1148,
                    46, 4899, 1059, 925, 3754, 3443, 2324, 4419, 3426, 4808, 475,
                ],
                [
                    1893, 878, 875, 1605, 906, 3288, 2329, 3018, 1893, 4713, 4858, 4352, 2631, 3018, 108, 3064, 1131,
                    860, 2415, 2188, 3933, 2779, 3185, 2412, 62, 2555, 1546, 3237,
                ],
                [
                    2630, 4836, 4533, 2613, 156, 1934, 364, 4208, 4424, 1455, 4065, 4990, 3230, 4331, 1986, 3877, 1240,
                    2399, 194, 4554, 1353, 1141, 2461, 2051, 3515, 1552, 4341, 3788,
                ],
                [
                    868, 4511, 996, 3258, 3147, 2480, 2716, 1437, 1416, 3641, 1016, 3479, 2831, 4060, 512, 372, 1765,
                    567, 2806, 1949, 389, 4837, 4453, 3922, 836, 1109, 694, 4194,
                ],
                [
                    3739, 328, 4706, 4456, 4654, 4882, 2658, 4833, 344, 4385, 1952, 3671, 4707, 4977, 3067, 2178, 4515,
                    2199, 826, 2894, 3745, 2547, 3660, 3522, 4435, 3266, 4469, 2249,
                ],
                [
                    1604, 283, 4104, 2772, 1448, 3087, 1277, 3578, 3774, 3297, 3239, 4848, 1982, 3255, 1129, 64, 4781,
                    2495, 2883, 4886, 237, 4951, 2128, 3344, 2565, 964, 871, 549,
                ],
                [
                    954, 185, 3016, 3074, 4083, 1804, 3842, 550, 131, 4086, 4497, 518, 415, 4934, 1067, 1767, 2933,
                    1360, 2527, 838, 4647, 4980, 4079, 4570, 4756, 3567, 4438, 4967,
                ],
                [
                    509, 4994, 467, 2886, 2344, 2222, 2602, 4397, 1127, 1583, 2799, 1697, 4780, 3311, 1167, 4355, 4614,
                    2710, 4258, 1213, 43, 63, 405, 1968, 3351, 4198, 2482, 4379,
                ],
                [
                    4281, 4046, 2585, 4015, 4262, 4410, 69, 806, 2302, 4005, 3939, 2058, 956, 4527, 1249, 3881, 2652,
                    4682, 1770, 2476, 1381, 1537, 187, 4927, 3583, 3146, 4596, 3527,
                ],
                [
                    1309, 299, 3176, 3563, 1107, 747, 3103, 1343, 1205, 927, 1040, 3383, 3073, 1234, 266, 4646, 3018,
                    4748, 4519, 4110, 3877, 1941, 3353, 1438, 3139, 605, 3687, 3592,
                ],
                [
                    4979, 4830, 4294, 3923, 1814, 4906, 566, 4355, 1242, 1935, 1408, 4533, 3635, 4165, 4378, 2712,
                    2050, 4176, 4219, 224, 63, 4925, 338, 4118, 2440, 4792, 4190, 4156,
                ],
                [
                    2600, 2092, 4955, 2593, 3419, 2478, 4622, 2785, 2711, 3257, 3466, 728, 705, 3958, 1975, 424, 1519,
                    1056, 2558, 1588, 646, 1814, 2472, 3008, 877, 2067, 2805, 698,
                ],
            ],
            657_206_608,
        ),
        &[
            [
                4373, 4225, 4352, 3820, 358, 4104, 1016, 1441, 1907, 674, 2256, 2441, 2925, 1329, 3335, 1193, 928, 873,
                4534, 3679, 721, 475, 3237, 3788, 4194, 2249, 549, 4967,
            ],
            [
                4837, 3223, 196, 3483, 94, 4654, 81, 3304, 2738, 1231, 2739, 3967, 653, 57, 270, 814, 2173, 2363, 616,
                1619, 4910, 4770, 2530, 2741, 2365, 4659, 4395, 4379,
            ],
            [
                2614, 2672, 4748, 3018, 4646, 266, 1234, 3073, 3383, 1040, 927, 1205, 1343, 3103, 747, 1107, 3563,
                3176, 2585, 467, 3016, 4104, 4706, 996, 4533, 875, 3047, 3527,
            ],
            [
                2864, 878, 4519, 1381, 2476, 1770, 4682, 2652, 3881, 1249, 4527, 956, 2058, 3939, 4005, 2302, 806, 69,
                4410, 4262, 4015, 2886, 3074, 2772, 4456, 707, 127, 3592,
            ],
            [
                1729, 4836, 4110, 1537, 1950, 1546, 300, 3769, 2317, 1123, 2565, 1685, 216, 2324, 2412, 2051, 3922,
                3522, 3344, 4570, 1968, 405, 63, 43, 3258, 585, 4963, 4156,
            ],
            [
                704, 4511, 3877, 187, 129, 3197, 1997, 2196, 157, 3189, 4428, 3443, 3185, 2461, 4453, 3660, 2128, 4079,
                4980, 4647, 838, 2527, 1360, 1213, 2613, 3162, 3414, 698,
            ],
            [
                1186, 328, 1941, 4927, 1572, 373, 4680, 3596, 1146, 3754, 2779, 1141, 4837, 2547, 4951, 237, 4886,
                2883, 2495, 4781, 64, 1129, 2933, 4258, 1605, 236, 4928, 2805,
            ],
            [
                1550, 283, 3353, 3583, 909, 4731, 3859, 905, 208, 3535, 1146, 726, 3811, 3321, 2223, 925, 3933, 1353,
                389, 3745, 2894, 3255, 1767, 2710, 4023, 3365, 3373, 2067,
            ],
            [
                2866, 185, 1438, 3351, 1848, 4132, 4938, 4721, 1949, 2806, 567, 1765, 372, 512, 4060, 2831, 3479, 1016,
                3641, 1416, 826, 1982, 1067, 4614, 715, 218, 339, 877,
            ],
            [
                1583, 4994, 3139, 4756, 3564, 3619, 3902, 673, 4554, 1986, 4331, 3230, 4990, 4065, 1455, 4713, 1061,
                3415, 1489, 4424, 2199, 4848, 4934, 4355, 262, 4906, 4367, 3008,
            ],
            [
                729, 4046, 605, 2565, 1499, 3922, 2030, 2726, 2188, 3877, 4998, 4264, 2589, 704, 2671, 3783, 1148, 46,
                2616, 1893, 4515, 3239, 415, 1167, 4925, 1915, 4830, 2472,
            ],
            [
                3444, 299, 3146, 4435, 4392, 434, 2229, 1791, 1059, 1240, 4858, 4352, 2631, 3018, 108, 3064, 1131, 860,
                1673, 214, 2178, 3297, 518, 3311, 1878, 304, 1447, 1814,
            ],
            [
                475, 4830, 4198, 836, 3028, 3914, 584, 621, 1942, 2399, 194, 2415, 4899, 3444, 932, 3866, 2995, 2413,
                2115, 2551, 3067, 3774, 4497, 4780, 4630, 4520, 882, 646,
            ],
            [
                3035, 4294, 3567, 3515, 2178, 2217, 2461, 3762, 2019, 610, 26, 4808, 894, 4092, 3608, 1791, 3983, 3875,
                403, 1693, 4977, 3578, 4086, 1697, 50, 2061, 4922, 1588,
            ],
            [
                3563, 3923, 964, 62, 271, 4099, 2411, 2174, 232, 2642, 2216, 4515, 3018, 4208, 1437, 4833, 344, 4385,
                1952, 3671, 4707, 1277, 131, 2799, 50, 172, 4657, 2558,
            ],
            [
                2615, 1814, 3266, 4419, 4972, 2448, 455, 3202, 2472, 1643, 4570, 1779, 1789, 180, 1707, 2601, 2000,
                2396, 2329, 364, 2716, 2658, 550, 1583, 610, 3348, 3425, 1056,
            ],
            [
                386, 4906, 1109, 2106, 355, 1764, 1547, 4823, 3477, 820, 1972, 149, 2869, 4110, 3337, 1430, 3288, 1934,
                2480, 4882, 3087, 1804, 3842, 1127, 2357, 4773, 4286, 1519,
            ],
            [
                4736, 566, 1552, 4755, 4087, 2284, 4856, 1802, 741, 3168, 4605, 4863, 124, 1242, 906, 156, 3147, 4654,
                1448, 4083, 2344, 2222, 2602, 4397, 1646, 503, 3472, 424,
            ],
            [
                81, 4355, 2555, 823, 4843, 2270, 3789, 3249, 4901, 1479, 2567, 1443, 2846, 2247, 4208, 2417, 1240,
                2632, 4915, 2545, 3824, 4083, 3408, 3466, 3948, 1583, 4808, 1975,
            ],
            [
                3622, 1242, 3426, 4311, 3273, 4707, 4368, 482, 4548, 619, 1761, 2183, 778, 1965, 2036, 3414, 3718, 28,
                1007, 2459, 741, 1174, 2693, 103, 3832, 1285, 1546, 3958,
            ],
            [
                2331, 1935, 1408, 4533, 3635, 4165, 4378, 2712, 2050, 4176, 4219, 224, 63, 4925, 338, 4118, 2440, 4792,
                4190, 3687, 4596, 2482, 4438, 871, 4469, 694, 4341, 705,
            ],
            [
                2122, 895, 2383, 3097, 1721, 4061, 1893, 2630, 868, 3739, 1604, 954, 509, 4281, 1309, 4979, 2600, 2092,
                4955, 2593, 3419, 2478, 4622, 2785, 2711, 3257, 3466, 728,
            ],
        ],
    );

    pub fn run<S: Solution>() {
        let test_cases = [
            (
                (&[[40, 10], [30, 20]] as &dyn Matrix<_>, 1),
                &[[10, 20], [40, 30]] as &dyn Matrix<_>,
            ),
            (
                (&[[1, 2, 3, 4], [5, 6, 7, 8], [9, 10, 11, 12], [13, 14, 15, 16]], 2),
                &[[3, 4, 8, 12], [2, 11, 10, 16], [1, 7, 6, 15], [5, 9, 13, 14]],
            ),
            (
                (
                    &[
                        [7, 8, 8, 10, 4, 7, 2, 8],
                        [4, 8, 9, 9, 1, 5, 9, 4],
                        [8, 9, 4, 8, 9, 9, 1, 5],
                        [1, 2, 7, 8, 10, 1, 1, 10],
                        [7, 6, 6, 8, 2, 5, 5, 4],
                        [7, 7, 3, 3, 6, 10, 10, 6],
                        [2, 5, 2, 9, 3, 9, 10, 2],
                        [7, 5, 8, 1, 3, 3, 4, 7],
                    ],
                    3,
                ),
                &[
                    [10, 4, 7, 2, 8, 4, 5, 10],
                    [8, 1, 5, 9, 1, 1, 5, 4],
                    [8, 9, 9, 1, 5, 10, 10, 6],
                    [7, 9, 9, 8, 8, 6, 10, 2],
                    [4, 8, 8, 2, 10, 3, 9, 7],
                    [8, 9, 4, 7, 6, 3, 3, 4],
                    [1, 2, 6, 7, 5, 2, 9, 3],
                    [7, 7, 2, 7, 5, 8, 1, 3],
                ],
            ),
            EXTRA_TEST_CASE,
        ];

        for ((grid, k), expected) in test_cases {
            assert_eq!(S::rotate_grid(grid.to_vec(), k), expected);
        }
    }
}
