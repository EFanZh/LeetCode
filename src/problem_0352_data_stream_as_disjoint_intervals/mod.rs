pub mod ordered_map;
pub mod union_find;

pub trait SummaryRanges {
    fn new() -> Self;
    fn add_num(&mut self, val: i32);
    fn get_intervals(&self) -> Vec<Vec<i32>>;
}

#[cfg(test)]
mod tests {
    use super::SummaryRanges;

    enum Operation {
        AddNum(i32),
        GetIntervals(&'static [[i32; 2]]),
    }

    const EXTRA_TEST_CASE: &[Operation] = &[
        Operation::AddNum(49),
        Operation::GetIntervals(&[[49, 49]]),
        Operation::AddNum(97),
        Operation::GetIntervals(&[[49, 49], [97, 97]]),
        Operation::AddNum(53),
        Operation::GetIntervals(&[[49, 49], [53, 53], [97, 97]]),
        Operation::AddNum(5),
        Operation::GetIntervals(&[[5, 5], [49, 49], [53, 53], [97, 97]]),
        Operation::AddNum(33),
        Operation::GetIntervals(&[[5, 5], [33, 33], [49, 49], [53, 53], [97, 97]]),
        Operation::AddNum(65),
        Operation::GetIntervals(&[[5, 5], [33, 33], [49, 49], [53, 53], [65, 65], [97, 97]]),
        Operation::AddNum(62),
        Operation::GetIntervals(&[[5, 5], [33, 33], [49, 49], [53, 53], [62, 62], [65, 65], [97, 97]]),
        Operation::AddNum(51),
        Operation::GetIntervals(&[
            [5, 5],
            [33, 33],
            [49, 49],
            [51, 51],
            [53, 53],
            [62, 62],
            [65, 65],
            [97, 97],
        ]),
        Operation::AddNum(100),
        Operation::GetIntervals(&[
            [5, 5],
            [33, 33],
            [49, 49],
            [51, 51],
            [53, 53],
            [62, 62],
            [65, 65],
            [97, 97],
            [100, 100],
        ]),
        Operation::AddNum(38),
        Operation::GetIntervals(&[
            [5, 5],
            [33, 33],
            [38, 38],
            [49, 49],
            [51, 51],
            [53, 53],
            [62, 62],
            [65, 65],
            [97, 97],
            [100, 100],
        ]),
        Operation::AddNum(61),
        Operation::GetIntervals(&[
            [5, 5],
            [33, 33],
            [38, 38],
            [49, 49],
            [51, 51],
            [53, 53],
            [61, 62],
            [65, 65],
            [97, 97],
            [100, 100],
        ]),
        Operation::AddNum(45),
        Operation::GetIntervals(&[
            [5, 5],
            [33, 33],
            [38, 38],
            [45, 45],
            [49, 49],
            [51, 51],
            [53, 53],
            [61, 62],
            [65, 65],
            [97, 97],
            [100, 100],
        ]),
        Operation::AddNum(74),
        Operation::GetIntervals(&[
            [5, 5],
            [33, 33],
            [38, 38],
            [45, 45],
            [49, 49],
            [51, 51],
            [53, 53],
            [61, 62],
            [65, 65],
            [74, 74],
            [97, 97],
            [100, 100],
        ]),
        Operation::AddNum(27),
        Operation::GetIntervals(&[
            [5, 5],
            [27, 27],
            [33, 33],
            [38, 38],
            [45, 45],
            [49, 49],
            [51, 51],
            [53, 53],
            [61, 62],
            [65, 65],
            [74, 74],
            [97, 97],
            [100, 100],
        ]),
        Operation::AddNum(64),
        Operation::GetIntervals(&[
            [5, 5],
            [27, 27],
            [33, 33],
            [38, 38],
            [45, 45],
            [49, 49],
            [51, 51],
            [53, 53],
            [61, 62],
            [64, 65],
            [74, 74],
            [97, 97],
            [100, 100],
        ]),
        Operation::AddNum(17),
        Operation::GetIntervals(&[
            [5, 5],
            [17, 17],
            [27, 27],
            [33, 33],
            [38, 38],
            [45, 45],
            [49, 49],
            [51, 51],
            [53, 53],
            [61, 62],
            [64, 65],
            [74, 74],
            [97, 97],
            [100, 100],
        ]),
        Operation::AddNum(36),
        Operation::GetIntervals(&[
            [5, 5],
            [17, 17],
            [27, 27],
            [33, 33],
            [36, 36],
            [38, 38],
            [45, 45],
            [49, 49],
            [51, 51],
            [53, 53],
            [61, 62],
            [64, 65],
            [74, 74],
            [97, 97],
            [100, 100],
        ]),
        Operation::AddNum(17),
        Operation::GetIntervals(&[
            [5, 5],
            [17, 17],
            [27, 27],
            [33, 33],
            [36, 36],
            [38, 38],
            [45, 45],
            [49, 49],
            [51, 51],
            [53, 53],
            [61, 62],
            [64, 65],
            [74, 74],
            [97, 97],
            [100, 100],
        ]),
        Operation::AddNum(96),
        Operation::GetIntervals(&[
            [5, 5],
            [17, 17],
            [27, 27],
            [33, 33],
            [36, 36],
            [38, 38],
            [45, 45],
            [49, 49],
            [51, 51],
            [53, 53],
            [61, 62],
            [64, 65],
            [74, 74],
            [96, 97],
            [100, 100],
        ]),
        Operation::AddNum(12),
        Operation::GetIntervals(&[
            [5, 5],
            [12, 12],
            [17, 17],
            [27, 27],
            [33, 33],
            [36, 36],
            [38, 38],
            [45, 45],
            [49, 49],
            [51, 51],
            [53, 53],
            [61, 62],
            [64, 65],
            [74, 74],
            [96, 97],
            [100, 100],
        ]),
        Operation::AddNum(79),
        Operation::GetIntervals(&[
            [5, 5],
            [12, 12],
            [17, 17],
            [27, 27],
            [33, 33],
            [36, 36],
            [38, 38],
            [45, 45],
            [49, 49],
            [51, 51],
            [53, 53],
            [61, 62],
            [64, 65],
            [74, 74],
            [79, 79],
            [96, 97],
            [100, 100],
        ]),
        Operation::AddNum(32),
        Operation::GetIntervals(&[
            [5, 5],
            [12, 12],
            [17, 17],
            [27, 27],
            [32, 33],
            [36, 36],
            [38, 38],
            [45, 45],
            [49, 49],
            [51, 51],
            [53, 53],
            [61, 62],
            [64, 65],
            [74, 74],
            [79, 79],
            [96, 97],
            [100, 100],
        ]),
        Operation::AddNum(68),
        Operation::GetIntervals(&[
            [5, 5],
            [12, 12],
            [17, 17],
            [27, 27],
            [32, 33],
            [36, 36],
            [38, 38],
            [45, 45],
            [49, 49],
            [51, 51],
            [53, 53],
            [61, 62],
            [64, 65],
            [68, 68],
            [74, 74],
            [79, 79],
            [96, 97],
            [100, 100],
        ]),
        Operation::AddNum(90),
        Operation::GetIntervals(&[
            [5, 5],
            [12, 12],
            [17, 17],
            [27, 27],
            [32, 33],
            [36, 36],
            [38, 38],
            [45, 45],
            [49, 49],
            [51, 51],
            [53, 53],
            [61, 62],
            [64, 65],
            [68, 68],
            [74, 74],
            [79, 79],
            [90, 90],
            [96, 97],
            [100, 100],
        ]),
        Operation::AddNum(77),
        Operation::GetIntervals(&[
            [5, 5],
            [12, 12],
            [17, 17],
            [27, 27],
            [32, 33],
            [36, 36],
            [38, 38],
            [45, 45],
            [49, 49],
            [51, 51],
            [53, 53],
            [61, 62],
            [64, 65],
            [68, 68],
            [74, 74],
            [77, 77],
            [79, 79],
            [90, 90],
            [96, 97],
            [100, 100],
        ]),
        Operation::AddNum(18),
        Operation::GetIntervals(&[
            [5, 5],
            [12, 12],
            [17, 18],
            [27, 27],
            [32, 33],
            [36, 36],
            [38, 38],
            [45, 45],
            [49, 49],
            [51, 51],
            [53, 53],
            [61, 62],
            [64, 65],
            [68, 68],
            [74, 74],
            [77, 77],
            [79, 79],
            [90, 90],
            [96, 97],
            [100, 100],
        ]),
        Operation::AddNum(39),
        Operation::GetIntervals(&[
            [5, 5],
            [12, 12],
            [17, 18],
            [27, 27],
            [32, 33],
            [36, 36],
            [38, 39],
            [45, 45],
            [49, 49],
            [51, 51],
            [53, 53],
            [61, 62],
            [64, 65],
            [68, 68],
            [74, 74],
            [77, 77],
            [79, 79],
            [90, 90],
            [96, 97],
            [100, 100],
        ]),
        Operation::AddNum(12),
        Operation::GetIntervals(&[
            [5, 5],
            [12, 12],
            [17, 18],
            [27, 27],
            [32, 33],
            [36, 36],
            [38, 39],
            [45, 45],
            [49, 49],
            [51, 51],
            [53, 53],
            [61, 62],
            [64, 65],
            [68, 68],
            [74, 74],
            [77, 77],
            [79, 79],
            [90, 90],
            [96, 97],
            [100, 100],
        ]),
        Operation::AddNum(93),
        Operation::GetIntervals(&[
            [5, 5],
            [12, 12],
            [17, 18],
            [27, 27],
            [32, 33],
            [36, 36],
            [38, 39],
            [45, 45],
            [49, 49],
            [51, 51],
            [53, 53],
            [61, 62],
            [64, 65],
            [68, 68],
            [74, 74],
            [77, 77],
            [79, 79],
            [90, 90],
            [93, 93],
            [96, 97],
            [100, 100],
        ]),
        Operation::AddNum(9),
        Operation::GetIntervals(&[
            [5, 5],
            [9, 9],
            [12, 12],
            [17, 18],
            [27, 27],
            [32, 33],
            [36, 36],
            [38, 39],
            [45, 45],
            [49, 49],
            [51, 51],
            [53, 53],
            [61, 62],
            [64, 65],
            [68, 68],
            [74, 74],
            [77, 77],
            [79, 79],
            [90, 90],
            [93, 93],
            [96, 97],
            [100, 100],
        ]),
        Operation::AddNum(87),
        Operation::GetIntervals(&[
            [5, 5],
            [9, 9],
            [12, 12],
            [17, 18],
            [27, 27],
            [32, 33],
            [36, 36],
            [38, 39],
            [45, 45],
            [49, 49],
            [51, 51],
            [53, 53],
            [61, 62],
            [64, 65],
            [68, 68],
            [74, 74],
            [77, 77],
            [79, 79],
            [87, 87],
            [90, 90],
            [93, 93],
            [96, 97],
            [100, 100],
        ]),
        Operation::AddNum(42),
        Operation::GetIntervals(&[
            [5, 5],
            [9, 9],
            [12, 12],
            [17, 18],
            [27, 27],
            [32, 33],
            [36, 36],
            [38, 39],
            [42, 42],
            [45, 45],
            [49, 49],
            [51, 51],
            [53, 53],
            [61, 62],
            [64, 65],
            [68, 68],
            [74, 74],
            [77, 77],
            [79, 79],
            [87, 87],
            [90, 90],
            [93, 93],
            [96, 97],
            [100, 100],
        ]),
        Operation::AddNum(60),
        Operation::AddNum(71),
        Operation::AddNum(12),
        Operation::AddNum(45),
        Operation::AddNum(55),
        Operation::AddNum(40),
        Operation::AddNum(78),
        Operation::AddNum(81),
        Operation::AddNum(26),
        Operation::AddNum(70),
        Operation::AddNum(61),
        Operation::AddNum(56),
        Operation::AddNum(66),
        Operation::AddNum(33),
        Operation::AddNum(7),
        Operation::AddNum(70),
        Operation::AddNum(1),
        Operation::AddNum(11),
        Operation::AddNum(92),
        Operation::AddNum(51),
        Operation::AddNum(90),
        Operation::AddNum(100),
        Operation::AddNum(85),
        Operation::AddNum(80),
        Operation::GetIntervals(&[
            [1, 1],
            [5, 5],
            [7, 7],
            [9, 9],
            [11, 12],
            [17, 18],
            [26, 27],
            [32, 33],
            [36, 36],
            [38, 40],
            [42, 42],
            [45, 45],
            [49, 49],
            [51, 51],
            [53, 53],
            [55, 56],
            [60, 62],
            [64, 66],
            [68, 68],
            [70, 71],
            [74, 74],
            [77, 81],
            [85, 85],
            [87, 87],
            [90, 90],
            [92, 93],
            [96, 97],
            [100, 100],
        ]),
    ];

    pub fn run<S: SummaryRanges>() {
        let test_cases = [
            &[
                Operation::AddNum(1),
                Operation::GetIntervals(&[[1, 1]]),
                Operation::AddNum(3),
                Operation::GetIntervals(&[[1, 1], [3, 3]]),
                Operation::AddNum(7),
                Operation::GetIntervals(&[[1, 1], [3, 3], [7, 7]]),
                Operation::AddNum(2),
                Operation::GetIntervals(&[[1, 3], [7, 7]]),
                Operation::AddNum(6),
                Operation::GetIntervals(&[[1, 3], [6, 7]]),
            ] as &[_],
            &[
                Operation::AddNum(6),
                Operation::GetIntervals(&[[6, 6]]),
                Operation::AddNum(6),
                Operation::GetIntervals(&[[6, 6]]),
                Operation::AddNum(0),
                Operation::GetIntervals(&[[0, 0], [6, 6]]),
                Operation::AddNum(4),
                Operation::GetIntervals(&[[0, 0], [4, 4], [6, 6]]),
                Operation::AddNum(8),
                Operation::GetIntervals(&[[0, 0], [4, 4], [6, 6], [8, 8]]),
                Operation::AddNum(7),
                Operation::GetIntervals(&[[0, 0], [4, 4], [6, 8]]),
                Operation::AddNum(6),
                Operation::GetIntervals(&[[0, 0], [4, 4], [6, 8]]),
                Operation::AddNum(4),
                Operation::GetIntervals(&[[0, 0], [4, 4], [6, 8]]),
                Operation::AddNum(7),
                Operation::GetIntervals(&[[0, 0], [4, 4], [6, 8]]),
                Operation::AddNum(5),
                Operation::GetIntervals(&[[0, 0], [4, 8]]),
            ],
            &[
                Operation::AddNum(1),
                Operation::GetIntervals(&[[1, 1]]),
                Operation::AddNum(9),
                Operation::GetIntervals(&[[1, 1], [9, 9]]),
                Operation::AddNum(2),
                Operation::GetIntervals(&[[1, 2], [9, 9]]),
            ],
            EXTRA_TEST_CASE,
        ];

        for operations in test_cases {
            let mut summary_ranges = S::new();

            for operation in operations {
                match *operation {
                    Operation::AddNum(val) => summary_ranges.add_num(val),
                    Operation::GetIntervals(expected) => assert_eq!(summary_ranges.get_intervals(), expected),
                }
            }
        }
    }
}
